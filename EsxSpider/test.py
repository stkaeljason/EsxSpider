#coding:utf-8

# python
# scrapy
import json
import sys
import requests



# sys.path.append('/home/jason/esx_work/ershixiong_auto/EsxSpider/')




sys.path.append('/data1/wwwroot/default/ershixiong_auto/EsxSpider')
import time


from db_model.AuxMerchant import query_aux_merchant
from EsxSpider.tools import get_every_addr
from appBot.meidi_api import get_engineers_data, login,get_orders
from db_model.MdDb import save_account, query_md_merchant

test_jd_datas= """{
    "total": 2,
    "history_flag": false,
    "imOrderSearchBaseInfo": {},
    "orderStatusIsBeenReceived": 5,
    "orderStatusIsBeenDispatching": 7,
    "imOrderSearchBaseInfoBack": {},
    "orderStatusIsAutoFail": 2,
    "orderStatusIsBeenAssigned": 3,
    "rows": [
        {
            "errorFlag": 0,
            "isDhcPos": null,
            "dhcSiteCode": null,
            "isLiveFeedback": null,
            "fastDealNumByColor": null,
            "history_flag": null,
            "orderno": 21922720,
            "ordernoSecret": "ac607e381fad00ac895d721857ebb395",
            "customerName": "杨燕",
            "customerTel": null,
            "customerPhone": "",
            "serviceStreet": "四川成都市锦江区三圣乡牡丹路595号鑫苑名家一期8栋2单元1005",
            "customerPin": "yychq",
            "productCode": null,
            "productName": "奥克斯（AUX）2匹 二级能效 冷暖 WIFI智能 京东微联APP控制 圆柱空调柜机(KFR-51LW/R1TC01+2)",
            "productType": 870,
            "productBrand": 3659,
            "productTypeName": "空调",
            "productBrandName": "奥克斯（AUX）",
            "orderId": "64723178574",
            "afsServiceId": null,
            "systemType": null,
            "serviceType": 0,
            "serviceTypeName": "安装单",
            "settlementType": null,
            "subCompanyId": "4",
            "subCompanyName": "成都分公司",
            "wareInfoId": "lw_4_992",
            "wareInfoIdList": null,
            "wareInfoIdOld": null,
            "wareInfoName": "成都安装运营中心",
            "outletsId": "028861803",
            "outletsName": "成华区智诚电器经营部",
            "createOrderTime": 1509477670000,
            "createOrderTimeBegin": null,
            "createOrderTimeEnd": null,
            "status": null,
            "engineerName": "侯凌飞",
            "yn": false,
            "ordernos": null,
            "ordernoGroup": null,
            "orderStatus": 9,
            "orderStatusName": "确认中",
            "reviewStatus": 0,
            "reviewStatusName": null,
            "startStatus": null,
            "endStatus": null,
            "reservationDate": 1509527120000,
            "reservationPeriod": "1",
            "reservationDateBegin": null,
            "reservationDateEnd": null,
            "wareId": 1553022,
            "returnVisitCount": null,
            "sortKind": null,
            "currentFlag": 1,
            "invoiceNumber": "10542207",
            "orderFinishDate": 1509520110,
            "distributionFinishDate": 1509497187,
            "expectAtHomeDate": "2017-11-02 08:00:00",
            "expectAtHomeDateBegin": null,
            "expectAtHomeDateEnd": null,
            "atHomeFinishDateBegin": null,
            "atHomeFinishDateEnd": null,
            "atHomeFinishDate": 1509527120000,
            "expectAtHomePeriod": null,
            "serviceProvinceId": "22",
            "serviceCityId": "1930",
            "serviceCountyId": "50945",
            "serviceDistrictId": "52160",
            "serviceProvince": "四川",
            "serviceCity": "成都市",
            "serviceCounty": "锦江区",
            "serviceDistrict": "三圣乡",
            "serviceReason": null,
            "serviceReasonName": null,
            "sysVersion": 1,
            "fastDealNum": null,
            "todayOtherReservationCondition": null,
            "todayOtherReservationConditionName": null,
            "otherReservation": null,
            "reservationDesc": null,
            "propramlist": null,
            "orderIds": null,
            "feedbackResultChild": null,
            "orderSearchStatus": null,
            "subCompanyIdHidden": null,
            "wareInfoIdHidden": null,
            "outletsIdHidden": null,
            "serviceTypeHidden": null,
            "feedbackStatusHidden": null,
            "reservationDateBeginHidden": null,
            "reservationDateEndHidden": null,
            "ordernoGroupHidden": null,
            "orderIdHidden": null,
            "customerNameHidden": null,
            "productTypeHidden": null,
            "afsServiceIdHidden": null,
            "customerTelHidden": null,
            "productBrandHidden": null,
            "invoiceNumberHidden": null,
            "customerPhoneHidden": null,
            "wareIdHidden": null,
            "orderStatusHidden": null,
            "customerPinHidden": null,
            "productNameHidden": null,
            "reviewStatusHidden": null,
            "serviceStreetHidden": null,
            "createOrderTimeBeginHidden": null,
            "createOrderTimeEndHidden": null,
            "returnVisitCountHidden": null,
            "sortKindHidden": null,
            "fastDealNumHidden": null,
            "orderSearchStatusHidden": null,
            "startRow": null,
            "otherReservationNum": null,
            "otherReservationNumHidden": null,
            "autoDistributionValidDate": null,
            "param": null,
            "eachFetchDataNum": null,
            "serverCount": null,
            "timeout": null,
            "outletsIds": null,
            "productBrands": null,
            "subCompanyIds": null,
            "productTypes": null,
            "reservationCheckFlag": null,
            "distributeDate": 1509477720000,
            "reportLessFlag": null,
            "deliveryDateString": null,
            "baseWebsiteNo": "028861803",
            "baseWebsiteName": "成华区智诚电器经营部",
            "baseWebsiteType": null,
            "feedbackSource": 2,
            "homePageDistinguish": null,
            "orderOrderStatus": 7,
            "deliveryDate": 1509520109000,
            "deliveryDateStart": null,
            "deliveryDateEnd": null,
            "orderOrderStatusName": "妥投",
            "orderDistributionDate": 1509580800000,
            "orderDistributionDateStr": null,
            "orderDistributionDateBegin": null,
            "orderDistributionDateEnd": null,
            "orderModifyDate": null,
            "selected": false,
            "orderType": 1,
            "reservationServiceTypeName": "安装",
            "realServiceTypeName": "null",
            "thApprovalTime": null,
            "thCompleteTime": null,
            "esSwitch": null,
            "reclaimno": null,
            "reclaimNoSecrect": null,
            "feedbackStatus": null,
            "feedbackResult": "完成",
            "engineerStatus": 30,
            "mobileFlag": null,
            "categoryNumList": null,
            "productType1": null,
            "productType2": null,
            "productType3": null,
            "productType1Name": "家用电器",
            "productType2Name": "大 家 电",
            "productType3Name": null,
            "grabStatus": "0",
            "grabType": "0",
            "isFast": "1",
            "serviceMode": null,
            "orgs": null,
            "freeinstall": 2,
            "serviceTime": 1509527049000,
            "castFeeType": null,
            "argsCode": null,
            "serverCodeStatus": 300,
            "argsValue": null,
            "insideCode": null,
            "outsideCode": null,
            "machineCode": null,
            "remark": null,
            "oneShopFlag": 0,
            "deliveryModel": 1,
            "createOrderTimeString": null,
            "feedBackFlag": false
        },
        {
            "errorFlag": 0,
            "isDhcPos": null,
            "dhcSiteCode": null,
            "isLiveFeedback": null,
            "fastDealNumByColor": null,
            "history_flag": null,
            "orderno": 21922724,
            "ordernoSecret": "efe0e376ac0d14a3b55c3bbfdd95e9fe",
            "customerName": "杨燕",
            "customerTel": null,
            "customerPhone": "",
            "serviceStreet": "四川成都市锦江区三圣乡牡丹路595号鑫苑名家一期8栋2单元1005",
            "customerPin": "yychq",
            "productCode": null,
            "productName": "奥克斯（AUX）大1匹 变频冷暖 一级能效 节能 智能空调挂机 京东微联APP控制(KFR-26GW/BpTLP1+1)",
            "productType": 870,
            "productBrand": 3659,
            "productTypeName": "空调",
            "productBrandName": "奥克斯（AUX）",
            "orderId": "64723178574",
            "afsServiceId": null,
            "systemType": null,
            "serviceType": 0,
            "serviceTypeName": "安装单",
            "settlementType": null,
            "subCompanyId": "4",
            "subCompanyName": "成都分公司",
            "wareInfoId": "lw_4_992",
            "wareInfoIdList": null,
            "wareInfoIdOld": null,
            "wareInfoName": "成都安装运营中心",
            "outletsId": "028861803",
            "outletsName": "成华区智诚电器经营部",
            "createOrderTime": 1509477670000,
            "createOrderTimeBegin": null,
            "createOrderTimeEnd": null,
            "status": null,
            "engineerName": "侯凌飞",
            "yn": false,
            "ordernos": null,
            "ordernoGroup": null,
            "orderStatus": 9,
            "orderStatusName": "确认中",
            "reviewStatus": 0,
            "reviewStatusName": null,
            "startStatus": null,
            "endStatus": null,
            "reservationDate": 1509527143000,
            "reservationPeriod": "1",
            "reservationDateBegin": null,
            "reservationDateEnd": null,
            "wareId": 2818252,
            "returnVisitCount": null,
            "sortKind": null,
            "currentFlag": 1,
            "invoiceNumber": null,
            "orderFinishDate": null,
            "distributionFinishDate": null,
            "expectAtHomeDate": "2017-11-02 08:00:00",
            "expectAtHomeDateBegin": null,
            "expectAtHomeDateEnd": null,
            "atHomeFinishDateBegin": null,
            "atHomeFinishDateEnd": null,
            "atHomeFinishDate": 1509527143000,
            "expectAtHomePeriod": null,
            "serviceProvinceId": "22",
            "serviceCityId": "1930",
            "serviceCountyId": "50945",
            "serviceDistrictId": "52160",
            "serviceProvince": "四川",
            "serviceCity": "成都市",
            "serviceCounty": "锦江区",
            "serviceDistrict": "三圣乡",
            "serviceReason": null,
            "serviceReasonName": null,
            "sysVersion": 1,
            "fastDealNum": null,
            "todayOtherReservationCondition": null,
            "todayOtherReservationConditionName": null,
            "otherReservation": null,
            "reservationDesc": null,
            "propramlist": null,
            "orderIds": null,
            "feedbackResultChild": null,
            "orderSearchStatus": null,
            "subCompanyIdHidden": null,
            "wareInfoIdHidden": null,
            "outletsIdHidden": null,
            "serviceTypeHidden": null,
            "feedbackStatusHidden": null,
            "reservationDateBeginHidden": null,
            "reservationDateEndHidden": null,
            "ordernoGroupHidden": null,
            "orderIdHidden": null,
            "customerNameHidden": null,
            "productTypeHidden": null,
            "afsServiceIdHidden": null,
            "customerTelHidden": null,
            "productBrandHidden": null,
            "invoiceNumberHidden": null,
            "customerPhoneHidden": null,
            "wareIdHidden": null,
            "orderStatusHidden": null,
            "customerPinHidden": null,
            "productNameHidden": null,
            "reviewStatusHidden": null,
            "serviceStreetHidden": null,
            "createOrderTimeBeginHidden": null,
            "createOrderTimeEndHidden": null,
            "returnVisitCountHidden": null,
            "sortKindHidden": null,
            "fastDealNumHidden": null,
            "orderSearchStatusHidden": null,
            "startRow": null,
            "otherReservationNum": null,
            "otherReservationNumHidden": null,
            "autoDistributionValidDate": null,
            "param": null,
            "eachFetchDataNum": null,
            "serverCount": null,
            "timeout": null,
            "outletsIds": null,
            "productBrands": null,
            "subCompanyIds": null,
            "productTypes": null,
            "reservationCheckFlag": null,
            "distributeDate": 1509477720000,
            "reportLessFlag": null,
            "deliveryDateString": null,
            "baseWebsiteNo": "028861803",
            "baseWebsiteName": "成华区智诚电器经营部",
            "baseWebsiteType": null,
            "feedbackSource": 2,
            "homePageDistinguish": null,
            "orderOrderStatus": 7,
            "deliveryDate": 1509520109000,
            "deliveryDateStart": null,
            "deliveryDateEnd": null,
            "orderOrderStatusName": "妥投",
            "orderDistributionDate": 1509580800000,
            "orderDistributionDateStr": null,
            "orderDistributionDateBegin": null,
            "orderDistributionDateEnd": null,
            "orderModifyDate": null,
            "selected": false,
            "orderType": 1,
            "reservationServiceTypeName": "安装",
            "realServiceTypeName": "null",
            "thApprovalTime": null,
            "thCompleteTime": null,
            "esSwitch": null,
            "reclaimno": null,
            "reclaimNoSecrect": null,
            "feedbackStatus": null,
            "feedbackResult": "完成",
            "engineerStatus": 30,
            "mobileFlag": null,
            "categoryNumList": null,
            "productType1": null,
            "productType2": null,
            "productType3": null,
            "productType1Name": "家用电器",
            "productType2Name": "大 家 电",
            "productType3Name": null,
            "grabStatus": "0",
            "grabType": "0",
            "isFast": "1",
            "serviceMode": null,
            "orgs": null,
            "freeinstall": 1,
            "serviceTime": 1509527052000,
            "castFeeType": null,
            "argsCode": null,
            "serverCodeStatus": 300,
            "argsValue": null,
            "insideCode": null,
            "outsideCode": null,
            "machineCode": null,
            "remark": null,
            "oneShopFlag": 0,
            "deliveryModel": 1,
            "createOrderTimeString": null,
            "feedBackFlag": false
        },
        {
            "errorFlag": 0,
            "isDhcPos": null,
            "dhcSiteCode": null,
            "isLiveFeedback": null,
            "fastDealNumByColor": null,
            "history_flag": null,
            "orderno": 21922728,
            "ordernoSecret": "ac607e381fad00ac895d721857ebb395",
            "customerName": "杨燕",
            "customerTel": null,
            "customerPhone": "",
            "serviceStreet": "四川成都市锦江区三圣乡牡丹路595号鑫苑名家一期8栋2单元1005",
            "customerPin": "yychq",
            "productCode": null,
            "productName": "奥克斯（AUX）2匹 二级能效 冷暖 WIFI智能 京东微联APP控制 圆柱空调柜机(KFR-51LW/R1TC01+2)",
            "productType": 870,
            "productBrand": 3659,
            "productTypeName": "空调",
            "productBrandName": "奥克斯（AUX）",
            "orderId": "64723178574",
            "afsServiceId": null,
            "systemType": null,
            "serviceType": 0,
            "serviceTypeName": "安装单",
            "settlementType": null,
            "subCompanyId": "4",
            "subCompanyName": "成都分公司",
            "wareInfoId": "lw_4_992",
            "wareInfoIdList": null,
            "wareInfoIdOld": null,
            "wareInfoName": "成都安装运营中心",
            "outletsId": "028861803",
            "outletsName": "成华区智诚电器经营部",
            "createOrderTime": 1509477670000,
            "createOrderTimeBegin": null,
            "createOrderTimeEnd": null,
            "status": null,
            "engineerName": "侯凌飞",
            "yn": false,
            "ordernos": null,
            "ordernoGroup": null,
            "orderStatus": 9,
            "orderStatusName": "确认中",
            "reviewStatus": 0,
            "reviewStatusName": null,
            "startStatus": null,
            "endStatus": null,
            "reservationDate": 1509527120000,
            "reservationPeriod": "1",
            "reservationDateBegin": null,
            "reservationDateEnd": null,
            "wareId": 1553022,
            "returnVisitCount": null,
            "sortKind": null,
            "currentFlag": 1,
            "invoiceNumber": "10542207",
            "orderFinishDate": 1509520110,
            "distributionFinishDate": 1509497187,
            "expectAtHomeDate": "2017-11-02 08:00:00",
            "expectAtHomeDateBegin": null,
            "expectAtHomeDateEnd": null,
            "atHomeFinishDateBegin": null,
            "atHomeFinishDateEnd": null,
            "atHomeFinishDate": 1509527120000,
            "expectAtHomePeriod": null,
            "serviceProvinceId": "22",
            "serviceCityId": "1930",
            "serviceCountyId": "50945",
            "serviceDistrictId": "52160",
            "serviceProvince": "四川",
            "serviceCity": "成都市",
            "serviceCounty": "锦江区",
            "serviceDistrict": "三圣乡",
            "serviceReason": null,
            "serviceReasonName": null,
            "sysVersion": 1,
            "fastDealNum": null,
            "todayOtherReservationCondition": null,
            "todayOtherReservationConditionName": null,
            "otherReservation": null,
            "reservationDesc": null,
            "propramlist": null,
            "orderIds": null,
            "feedbackResultChild": null,
            "orderSearchStatus": null,
            "subCompanyIdHidden": null,
            "wareInfoIdHidden": null,
            "outletsIdHidden": null,
            "serviceTypeHidden": null,
            "feedbackStatusHidden": null,
            "reservationDateBeginHidden": null,
            "reservationDateEndHidden": null,
            "ordernoGroupHidden": null,
            "orderIdHidden": null,
            "customerNameHidden": null,
            "productTypeHidden": null,
            "afsServiceIdHidden": null,
            "customerTelHidden": null,
            "productBrandHidden": null,
            "invoiceNumberHidden": null,
            "customerPhoneHidden": null,
            "wareIdHidden": null,
            "orderStatusHidden": null,
            "customerPinHidden": null,
            "productNameHidden": null,
            "reviewStatusHidden": null,
            "serviceStreetHidden": null,
            "createOrderTimeBeginHidden": null,
            "createOrderTimeEndHidden": null,
            "returnVisitCountHidden": null,
            "sortKindHidden": null,
            "fastDealNumHidden": null,
            "orderSearchStatusHidden": null,
            "startRow": null,
            "otherReservationNum": null,
            "otherReservationNumHidden": null,
            "autoDistributionValidDate": null,
            "param": null,
            "eachFetchDataNum": null,
            "serverCount": null,
            "timeout": null,
            "outletsIds": null,
            "productBrands": null,
            "subCompanyIds": null,
            "productTypes": null,
            "reservationCheckFlag": null,
            "distributeDate": 1509477720000,
            "reportLessFlag": null,
            "deliveryDateString": null,
            "baseWebsiteNo": "028861803",
            "baseWebsiteName": "成华区智诚电器经营部",
            "baseWebsiteType": null,
            "feedbackSource": 2,
            "homePageDistinguish": null,
            "orderOrderStatus": 7,
            "deliveryDate": 1509520109000,
            "deliveryDateStart": null,
            "deliveryDateEnd": null,
            "orderOrderStatusName": "妥投",
            "orderDistributionDate": 1509580800000,
            "orderDistributionDateStr": null,
            "orderDistributionDateBegin": null,
            "orderDistributionDateEnd": null,
            "orderModifyDate": null,
            "selected": false,
            "orderType": 1,
            "reservationServiceTypeName": "安装",
            "realServiceTypeName": "null",
            "thApprovalTime": null,
            "thCompleteTime": null,
            "esSwitch": null,
            "reclaimno": null,
            "reclaimNoSecrect": null,
            "feedbackStatus": null,
            "feedbackResult": "完成",
            "engineerStatus": 30,
            "mobileFlag": null,
            "categoryNumList": null,
            "productType1": null,
            "productType2": null,
            "productType3": null,
            "productType1Name": "家用电器",
            "productType2Name": "大 家 电",
            "productType3Name": null,
            "grabStatus": "0",
            "grabType": "0",
            "isFast": "1",
            "serviceMode": null,
            "orgs": null,
            "freeinstall": 2,
            "serviceTime": 1509527049000,
            "castFeeType": null,
            "argsCode": null,
            "serverCodeStatus": 300,
            "argsValue": null,
            "insideCode": null,
            "outsideCode": null,
            "machineCode": null,
            "remark": null,
            "oneShopFlag": 0,
            "deliveryModel": 1,
            "createOrderTimeString": null,
            "feedBackFlag": false
        }
    ],
    "orderStatusIsBeenAppointment": 6
}"""

if __name__ == "__main__":
    # print get_every_addr(u'四川省成都市成华区成华区驷马桥街道园风水袋金典3栋21-1')
    # print get_every_addr(u'四川省成都市成华区升仙湖北路68号沙河路苑5-3-601')
    # print get_every_addr(u'四川省成都市天天区双水碾街道升仙湖北路68号沙河路苑5-3-601')
    # print get_every_addr(u'四川省成都市高新区高新区双水碾街道升仙湖北路68号沙河路苑5-3-601')
    # print get_every_addr(u'四川省成都市成华区双水碾街升仙湖北路68号沙河路苑5-3-601')
    cookies = login('AW5101007150','Css2017')
    get_orders(cookies)
